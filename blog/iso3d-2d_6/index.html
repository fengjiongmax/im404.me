<!DOCTYPE html>
<html lang="en-us">
    <head>
        
        <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="chrome=1">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="no-referrer">

<title>
Isometric 3 D in 2 D Environment #6 Movement Adjusting - fengjiongmax
</title>



        
        <meta property="og:title" content="Isometric 3D in 2D Environment #6 Movement adjusting - fengjiongmax" />
<meta property="og:type" content="website" />
<meta property="og:description" content=""/>
<meta property="og:url" content="https://im404.me/blog/iso3d-2d_6/"/>
<meta property="og:site_name" content="fengjiongmax"/>




<meta property="og:image" content="https://im404.me/home/avatar.png"/>




        
<link rel="shortcut icon" href="/img/fav.ico">


        





<link rel="stylesheet" href="/css/main.min.4a4491185af10b954e6b52118eb4e5102f9c12886169abe610804d5b095c965a.css" integrity="sha256-SkSRGFrxC5VOa1IRjrTlEC&#43;cEohhaavmEIBNWwlcllo=" crossorigin="anonymous" media="screen">





        
        
        
        
    </head>
    <body>
        <section id="top" class="section">
            
            <div class="container hero ">
                

<h1 class="bold-title is-1">Blog</h1>


            </div>
            
            <div class="section ">
                
<div class="container">
    <hr>
    <nav class="navbar" role="navigation" aria-label="main navigation">
        
        <a role="button" class="navbar-burger" data-target="navMenu" aria-label="menu" aria-expanded="false" >
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
        </a>
        <div class="navbar-menu " id="navMenu">
            
            
            
            
            <a class="navbar-item" href="/">main</a>
            

            
            

            
                
            

            
                
            

            
            
            
            <a class="navbar-item" href="/#about">About</a>
            
            
            
            
            
                
                
                
                
                  <a class="navbar-item" href="https://im404.me/blog/">
                  
                  Back to Blog
                  
                  </a>
                
                
            
            
            
            
            
                
                
                
                
                  <a class="navbar-item" href="https://im404.me/projects/">
                  
                  
                  Projects
                  
                  
                  </a>
                
                
            
            
            
            

            
            
            

            

            
            <a class="navbar-item" href="https://im404.me/index.xml"><i class="fas fa-rss"></i></a>
            
            
        </div>
    </nav>
    <hr>
</div>



                
<div class="container">
    <h2 class="title is-1 top-pad strong-post-title">
        <a href="https://im404.me/blog/iso3d-2d_6/">Isometric 3D in 2D Environment #6 Movement adjusting</a>
    </h2>
    <div class="post-data">
        Apr 21, 2021 |
        2 minutes read
    </div>
    
    <div class="blog-share">
        Share this:
        
        <a class="twitter-share-button" href="https://twitter.com/intent/tweet?text=Isometric%203D%20in%202D%20Environment%20%236%20Movement%20adjusting%20https%3a%2f%2fim404.me%2fblog%2fiso3d-2d_6%2f" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
            <i class="fab fa-twitter"></i>
            <span class="hidden">Twitter</span>
        </a>
        
        
        <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fim404.me%2fblog%2fiso3d-2d_6%2f" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
            <i class="fab fa-facebook-f"></i>
            <span class="hidden">Facebook</span>
        </a>
        
        
        <a class="icon-pinterest" href="http://pinterest.com/pin/create/button/?url=https%3a%2f%2fim404.me%2fblog%2fiso3d-2d_6%2f&amp;description=Isometric%203D%20in%202D%20Environment%20%236%20Movement%20adjusting" onclick="window.open(this.href, 'pinterest-share','width=580,height=296');return false;">
            <i class="fab fa-pinterest-p"></i>
            <span class="hidden">Pinterest</span>
        </a>
        
    </div>
    
    
      
      
     <p>
         Categories: 
          
           <a href="/categories/ladder_box">
             Ladder_Box</a>
         
        </p>
      
    
      
    
      
    
      
    
      
    
      
    
      
      
     <p>
         Series: 
          
           <a href="/series/3d_iso_in_2d">
             3D_iso_in_2D</a>
         
        </p>
      
    
      
      
     <p>
         Tags: 
          
           <a href="/tags/godot_engine">
             Godot_Engine</a>,
         
           <a href="/tags/tutorial">
             Tutorial</a>,
         
           <a href="/tags/gdscript">
             GDScript</a>,
         
           <a href="/tags/ladder_box">
             Ladder_Box</a>
         
        </p>
      
    
      
    
</div>

<div class="container markdown top-pad">
    <p>This is part 5 of the 2d/3d(game/engine) conversion used in my puzzle game: Ladder Box, which is available on Steam:</p>

<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="https://www.youtube.com/embed/-PINYXwhEkc" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div>

<p><a href="https://store.steampowered.com/app/1444390/Ladder_Box/"><img src="/img/steam.png" alt="get it on steam"></a></p>
<p>You can find all the textures, scripts in this GitHub repo: <a href="https://github.com/fengjiongmax/3D_iso_in_2D">https://github.com/fengjiongmax/3D_iso_in_2D</a></p>
<p>Godot 3.2.x is used in this project, you can check the commits for what&rsquo;s new in each part of this series.</p>

<h1 id="limit-userinput" class="anchor-link"><a href="#limit-userinput">Limit user input</a></h1>
<p>In the last 5 part of this series, we&rsquo;ve made all the states working, but we did not limit user input when the movable are moving, so this could happen:</p>
<p><img src="/img/iso3D-2D-6th/no_limit_input.gif" alt="">
I&rsquo;m hitting a,z,x,s randomlyWe should be processing user input when all movables are in idle state, let&rsquo;s do this.
Just add these code at the beginning of <code>send_command</code> function in main.gd:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-gdscript" data-lang="gdscript"><span style="color:#66d9ef">func</span> send_command(command:<span style="color:#a6e22e">Vector3</span>) <span style="color:#f92672">-&gt;</span> void:
	<span style="color:#66d9ef">var</span> _idle_count:<span style="color:#a6e22e">int</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
	<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> sorted:
		<span style="color:#66d9ef">if</span> i<span style="color:#f92672">.</span>get_node(<span style="color:#e6db74">&#34;state_machine&#34;</span>)<span style="color:#f92672">.</span>state<span style="color:#f92672">.</span>name <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;idle&#34;</span>:
			_idle_count <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
	<span style="color:#66d9ef">if</span> _idle_count <span style="color:#f92672">==</span> sorted<span style="color:#f92672">.</span>size():
		sorted <span style="color:#f92672">=</span> Grid<span style="color:#f92672">.</span>sort_by_direction(command)
		<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> sorted:
			i<span style="color:#f92672">.</span>receive_command({<span style="color:#e6db74">&#34;direction&#34;</span>:command})
		set_physics_process(true)
</code></pre></div>
<h1 id="beheavior-tweaking" class="anchor-link"><a href="#beheavior-tweaking">Beheavior Tweaking</a></h1>

<h2 id="idle--fall" class="anchor-link"><a href="#idle--fall">Idle -&gt; fall</a></h2>
<p>Create a board as follows:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-gdscript" data-lang="gdscript">new_movable(<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>)
new_movable(<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">0</span>)

new_unmovable(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">0</span>)
new_unmovable(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">0</span>)
new_unmovable(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">0</span>)
</code></pre></div><p>And you will see this:
<img src="/img/iso3D-2D-6th/idle_to_fall.gif" alt=""></p>
<p>We need to check if movable can fall in idle, add this to the end of the _command in idle.gd:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-gdscript" data-lang="gdscript"><span style="color:#66d9ef">elif</span> _msg<span style="color:#f92672">.</span>keys()<span style="color:#f92672">.</span>has(<span style="color:#e6db74">&#34;reach_target&#34;</span>):
    <span style="color:#66d9ef">if</span> Grid<span style="color:#f92672">.</span>coordinate_within_rangev(movable<span style="color:#f92672">.</span>game_pos <span style="color:#f92672">+</span> <span style="color:#a6e22e">Vector3</span><span style="color:#f92672">.</span>DOWN) <span style="color:#f92672">&amp;&amp;</span>\
    Grid<span style="color:#f92672">.</span>get_game_axisv(movable<span style="color:#f92672">.</span>game_pos <span style="color:#f92672">+</span> <span style="color:#a6e22e">Vector3</span><span style="color:#f92672">.</span>DOWN) <span style="color:#f92672">==</span> null:
        _state_machine<span style="color:#f92672">.</span>switch_state(<span style="color:#e6db74">&#34;fall&#34;</span>,{})
        <span style="color:#66d9ef">pass</span>
    <span style="color:#66d9ef">pass</span>
</code></pre></div><p><img src="/img/iso3D-2D-6th/fall_to_jump.gif" alt="">
it falls, but then jump to the roof, because when from idle to fall, the msg does not contain direction, and in <code>jump.gd</code>, <code>move_direcion</code> is default value, which is <code>V3(0,0,0)</code>, and we need to check <code>move_direction</code>.</p>

<h1 id="jumpable-check" class="anchor-link"><a href="#jumpable-check">Jumpable check</a></h1>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-gdscript" data-lang="gdscript">new_movable(<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>)
new_movable(<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">0</span>)
 
new_unmovable(<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">0</span>)
new_unmovable(<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>)
 
new_unmovable(<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">3</span>)
</code></pre></div><p><img src="/img/iso3D-2D-6th/jump_check.gif" alt=""></p>
<p>This can be fixed in movable.is_direction_jumpable:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-gdscript" data-lang="gdscript"><span style="color:#66d9ef">func</span> is_direction_jumpable(direction:<span style="color:#a6e22e">Vector3</span>) <span style="color:#f92672">-&gt;</span> <span style="color:#a6e22e">bool</span>:
    <span style="color:#66d9ef">if</span> direction <span style="color:#f92672">in</span> [<span style="color:#a6e22e">Vector3</span><span style="color:#f92672">.</span>UP,<span style="color:#a6e22e">Vector3</span><span style="color:#f92672">.</span>DOWN]:
        <span style="color:#66d9ef">return</span> false

    <span style="color:#66d9ef">var</span> _self_up_coordinate <span style="color:#f92672">=</span> game_pos <span style="color:#f92672">+</span> <span style="color:#a6e22e">Vector3</span><span style="color:#f92672">.</span>UP
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">!</span>Grid<span style="color:#f92672">.</span>coordinate_within_rangev(_self_up_coordinate):
        <span style="color:#66d9ef">return</span> false
    <span style="color:#66d9ef">var</span> _self_up_item <span style="color:#f92672">=</span> Grid<span style="color:#f92672">.</span>get_game_axisv(_self_up_coordinate)
    <span style="color:#66d9ef">if</span> _self_up_item <span style="color:#f92672">!=</span> null:
        <span style="color:#66d9ef">return</span> false

    <span style="color:#66d9ef">var</span> _self_up_up_coordinate <span style="color:#f92672">=</span> game_pos <span style="color:#f92672">+</span> <span style="color:#a6e22e">Vector3</span><span style="color:#f92672">.</span>UP<span style="color:#f92672">*</span><span style="color:#ae81ff">2</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">!</span>Grid<span style="color:#f92672">.</span>coordinate_within_rangev(_self_up_up_coordinate):
        <span style="color:#66d9ef">return</span> false
    <span style="color:#66d9ef">var</span> _self_up_up_item <span style="color:#f92672">=</span> Grid<span style="color:#f92672">.</span>get_game_axisv(_self_up_up_coordinate)
    <span style="color:#66d9ef">if</span> _self_up_up_item <span style="color:#f92672">!=</span> null:
        <span style="color:#66d9ef">return</span> false

    <span style="color:#66d9ef">var</span> _direction_up_axie <span style="color:#f92672">=</span> game_pos <span style="color:#f92672">+</span> direction <span style="color:#f92672">+</span> <span style="color:#a6e22e">Vector3</span><span style="color:#f92672">.</span>UP
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">!</span>Grid<span style="color:#f92672">.</span>coordinate_within_rangev(_direction_up_axie):
        <span style="color:#66d9ef">return</span> false

    <span style="color:#66d9ef">var</span> _direction_up_item <span style="color:#f92672">=</span> Grid<span style="color:#f92672">.</span>get_game_axisv(_direction_up_axie)
    <span style="color:#66d9ef">if</span> _direction_up_item <span style="color:#f92672">!=</span> null:
        <span style="color:#66d9ef">return</span> false

    <span style="color:#66d9ef">return</span> true
</code></pre></div><p>And the result:
<img src="/img/iso3D-2D-6th/correct_jump_check.gif" alt=""></p>
<p>That&rsquo;s it for this part. If you read all the way through, thank you and congratulation! It took me years to figure out how to make these things work as expected, and make a game out of it. And by the way, the code in the Github repo is wayyy better than the code in Ladder Box.</p>
<p>Hope you can make something fun out of it!</p>
<p>You can find all the textures, scripts in this GitHub repo: <a href="https://github.com/fengjiongmax/3D_iso_in_2D">https://github.com/fengjiongmax/3D_iso_in_2D</a></p>

</div>


    <div class="container disqus">
        <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "fjmax" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>



                
                <div class="container">
    <hr>
</div>
<div class="container has-text-centered top-pad">
    <a href="#top">
        <i class="fa fa-arrow-up"></i>
    </a>
</div>

<div class="container">
    <hr>
</div>

                <div class="section" id="footer">
    <div class="container has-text-centered">
    
        <span class="footer-text">
            <a href="https://github.com/victoriadrake/hugo-theme-introduction/"><strong>Introduction</strong></a> theme for <a href="http://gohugo.io/">Hugo</a>. Made with <a href="https://victoria.dev"><!-- raw HTML omitted --><!-- raw HTML omitted --> and <!-- raw HTML omitted --><!-- raw HTML omitted --></a> by open source contributors.
        </span>
    
    </div>
</div>

                
            </div>
        </section>
        
        


<script src="https://im404.me/js/bundle.2ee571453a8980175e10bda96bda797cc9c4e2e745e488df68d50cef5deb57ff.js" integrity="sha256-LuVxRTqJgBdeEL2pa9p5fMnE4udF5IjfaNUM713rV/8="></script>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'G-KPT6VZPK03', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>





        
        
        
        
    </body>
</html>
